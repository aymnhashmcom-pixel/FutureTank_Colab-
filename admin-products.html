<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBmWKWIPtVjUYXGOF77Zstmz3ROpvKIDog",
  authDomain: "futuretank-68c26.firebaseapp.com",
  projectId: "futuretank-68c26",
  storageBucket: "futuretank-68c26.appspot.com"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const list = document.getElementById("productsList");

window.addProduct = async () => {
  try {
    const name = productName.value.trim();
    const price = productPrice.value.trim();
    const image = productImage.files[0];
    const video = productVideo.files[0];

    if (!name || !price || !image) {
      alert("ุงูุงุณู + ุงูุณุนุฑ + ุงูุตูุฑุฉ ูุทููุจุฉ");
      return;
    }

    // ุฑูุน ุงูุตูุฑุฉ
    const imgRef = ref(storage, `products/images/${Date.now()}_${image.name}`);
    await uploadBytes(imgRef, image);
    const imageUrl = await getDownloadURL(imgRef);

    // ุฑูุน ุงูููุฏูู (ุงุฎุชูุงุฑู)
    let videoUrl = "";
    if (video) {
      const vidRef = ref(storage, `products/videos/${Date.now()}_${video.name}`);
      await uploadBytes(vidRef, video);
      videoUrl = await getDownloadURL(vidRef);
    }

    // ุญูุธ ุงูููุชุฌ
    await addDoc(collection(db, "products"), {
      name,
      price,
      imageUrl,
      videoUrl,
      createdAt: new Date()
    });

    alert("โ ุชู ุฅุถุงูุฉ ุงูููุชุฌ ุจูุฌุงุญ");
    productName.value = "";
    productPrice.value = "";
    productImage.value = "";
    productVideo.value = "";
    loadProducts();

  } catch (e) {
    alert("โ ุฎุทุฃ: " + e.message);
  }
};

async function loadProducts() {
  list.innerHTML = "";
  const snap = await getDocs(collection(db, "products"));
  snap.forEach(d => {
    const p = d.data();
    list.innerHTML += `
      <div style="margin:10px 0">
        <b>${p.name}</b> โ ${p.price} ุฌููู
        <button onclick="deleteProduct('${d.id}')">๐ ุญุฐู</button>
      </div>
    `;
  });
}
loadProducts();

window.deleteProduct = async (id) => {
  await deleteDoc(doc(db, "products", id));
  loadProducts();
};
</script>
</head>

<body>

<h2>๐ ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</h2>

<input id="productName" placeholder="ุงุณู ุงูููุชุฌ"><br><br>
<input id="productPrice" placeholder="ุงูุณุนุฑ"><br><br>
<input type="file" id="productImage" accept="image/*"><br><br>
<input type="file" id="productVideo" accept="video/*"><br><br>

<button onclick="addProduct()">โ ุฅุถุงูุฉ ุงูููุชุฌ</button>

<hr>
<div id="productsList"></div>

</body>
</html>
