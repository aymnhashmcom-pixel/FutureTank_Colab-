<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBmWKWIPtVjUYXGOF77Zstmz3ROpvKIDog",
  authDomain: "futuretank-68c26.firebaseapp.com",
  projectId: "futuretank-68c26",
  storageBucket: "futuretank-68c26.appspot.com"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const list = document.getElementById("list");

/* ุฅุถุงูุฉ ููุชุฌ */
window.addProduct = async () => {
  const name = productName.value;
  const price = productPrice.value;
  const imageFile = productImage.files[0];
  const videoFile = productVideo.files[0];

  if (!name || !price || !imageFile) {
    alert("ุงูุงุณู + ุงูุณุนุฑ + ุตูุฑุฉ ูุทููุจุฉ");
    return;
  }

  const imgRef = ref(storage, `products/images/${Date.now()}_${imageFile.name}`);
  await uploadBytes(imgRef, imageFile);
  const imageUrl = await getDownloadURL(imgRef);

  let videoUrl = "";
  if (videoFile) {
    const vidRef = ref(storage, `products/videos/${Date.now()}_${videoFile.name}`);
    await uploadBytes(vidRef, videoFile);
    videoUrl = await getDownloadURL(vidRef);
  }

  await addDoc(collection(db, "products"), {
    name,
    price,
    imageUrl,
    videoUrl,
    createdAt: new Date()
  });

  alert("ุชู ุฅุถุงูุฉ ุงูููุชุฌ");
  loadProducts();
};

/* ุชุญููู ุงูููุชุฌุงุช */
async function loadProducts() {
  list.innerHTML = "";
  const snap = await getDocs(collection(db, "products"));
  snap.forEach(d => {
    const p = d.data();
    list.innerHTML += `
      <div>
        <b>${p.name}</b> - ${p.price} ุฌููู
        <button onclick="deleteProduct('${d.id}')">๐ ุญุฐู</button>
      </div>
    `;
  });
}
loadProducts();

window.deleteProduct = async (id) => {
  await deleteDoc(doc(db, "products", id));
  loadProducts();
};
</script>
</head>

<body>
<h2>๐ ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</h2>

<input id="productName" placeholder="ุงุณู ุงูููุชุฌ"><br>
<input id="productPrice" placeholder="ุงูุณุนุฑ"><br>
<input type="file" id="productImage" accept="image/*"><br>
<input type="file" id="productVideo" accept="video/*"><br><br>

<button onclick="addProduct()">โ ุฅุถุงูุฉ ุงูููุชุฌ</button>

<hr>
<div id="list"></div>
</body>
</html>
