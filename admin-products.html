<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ›’ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª â€” FutureTank</title>

<style>
body{font-family:Tahoma;background:#f4f9ff;padding:20px}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:10px}
img,video{max-width:120px;display:block;margin-top:8px}
button{margin-top:8px}
</style>
</head>

<body>

<script src="auth.js"></script>
<script>requireRole("admin");</script>

<h2>ğŸ›’ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>

<div id="products"></div>

<h3>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>

<input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬"><br><br>
<input id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±"><br><br>
<textarea id="desc" placeholder="Ø§Ù„ÙˆØµÙ"></textarea><br><br>

<label>ğŸ“· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</label><br>
<input type="file" id="image" accept="image/*"><br><br>

<label>ğŸ¥ ÙÙŠØ¯ÙŠÙˆ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><br>
<input type="file" id="video" accept="video/*"><br><br>

<button onclick="addProduct()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>

<script>
const db = JSON.parse(localStorage.getItem("ft_db")||"{}");
db.products = db.products || [];

function render(){
  const div=document.getElementById("products");
  div.innerHTML="";
  db.products.forEach((p,i)=>{
    div.innerHTML+=`
    <div class="card">
      <b>${p.name}</b><br>
      Ø§Ù„Ø³Ø¹Ø±: ${p.price} Ø¬Ù†ÙŠÙ‡<br>
      ${p.desc||""}
      ${p.image?`<img src="${p.image}">`:""}
      ${p.video?`<video src="${p.video}" controls></video>`:""}
      <br>
      <button onclick="del(${i})">Ø­Ø°Ù</button>
    </div>`;
  });
}
render();

function toBase64(file){
  return new Promise(res=>{
    const r=new FileReader();
    r.onload=()=>res(r.result);
    r.readAsDataURL(file);
  });
}

async function addProduct(){
  const name=nameInput.value||name.value;
  const price=priceInput?.value||price.value;
  const desc=document.getElementById("desc").value;
  const img=document.getElementById("image").files[0];
  const vid=document.getElementById("video").files[0];

  const product={name,price,desc};

  if(img) product.image=await toBase64(img);
  if(vid) product.video=await toBase64(vid);

  db.products.push(product);
  localStorage.setItem("ft_db",JSON.stringify(db));
  location.reload();
}

function del(i){
  db.products.splice(i,1);
  localStorage.setItem("ft_db",JSON.stringify(db));
  location.reload();
}
</script>

</body>
</html>
