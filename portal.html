<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - FutureTank</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h2>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>

<input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<button onclick="getContract()">Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</button>

<div id="result"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxm2p2UAJrEUG2sNi8vbkKBGsZKS4joiEEmIV8Skl6iAgZSgFzm5GP_n-RPRsDQCJJp/exec";

function getContract() {
  const phone = document.getElementById("phone").value.trim();
  const result = document.getElementById("result");

  if (!phone) {
    result.innerHTML = "âŒ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ";
    return;
  }

  result.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...";

  fetch(API_URL + "?phone=" + encodeURIComponent(phone))
    .then(res => res.json())
    .then(data => {
      if (data.success && data.contract) {

        let html = `
<b>Ø§Ù„Ø§Ø³Ù…:</b> ${data.contract.name}<br>
<b>Ø§Ù„Ù‡Ø§ØªÙ:</b> ${data.contract.phone}<br>
<b>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</b> ${data.contract.address}<br>
<b>Ø§Ù„Ø®Ø¯Ù…Ø©:</b> ${data.contract.service}<br>
<b>Ù…Ø¯Ø© Ø§Ù„ØªØ¹Ø§Ù‚Ø¯:</b> ${data.contract.duration}<br>
<b>Ø§Ù„ØªÙƒÙ„ÙØ©:</b> ${data.contract.cost}<br>
<b>Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©:</b> ${data.contract.lastVisit}<br>
<b>Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©:</b> ${data.contract.nextVisit}<br>
<b>ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¹Ù‚Ø¯:</b> ${data.contract.endDate}<br>
`;

        if (data.contract.canRenew) {
          html += `<br><button onclick="renewContract()">ğŸ” ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</button>`;
        }

        result.innerHTML = html;

      } else {
        result.innerHTML = "âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ¹Ø§Ù‚Ø¯ Ù…Ø³Ø¬Ù„";
      }
    })
    .catch(() => {
      result.innerHTML = "âŒ Ø®Ø·Ø£ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…";
    });
}

function renewContract() {
  const phone = document.getElementById("phone").value.trim();
  if (!phone) return;

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams({
      action: "renew",
      phone: phone
    })
  })
  .then(res => res.json())
  .then(data => {
    alert(data.success ? "âœ… ØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ Ø¨Ù†Ø¬Ø§Ø­" : "âŒ ÙØ´Ù„ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯");
  })
  .catch(() => {
    alert("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯");
  });
}
</script>

</body>
</html>
