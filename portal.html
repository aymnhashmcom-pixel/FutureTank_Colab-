<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - FutureTank</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: Arial; padding: 20px; }
    .card { border: 1px solid #ddd; padding: 15px; border-radius: 10px; margin-top: 15px; }
    .whatsapp {
      display: inline-block;
      margin-top: 15px;
      background: #25d366;
      color: #fff;
      padding: 10px 15px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h2>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>

<input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<button onclick="getContract()">Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</button>

<div id="result"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwUd-scZifaiD2hiNY_PHBSNO7E8-BgAkdthieWJvMA_3-wZaTOBF1z2LSfuRVxVaGY/exec"; // ğŸ”´ Ø¶Ø¹ Ø±Ø§Ø¨Ø· Apps Script Ù‡Ù†Ø§

function getContract() {
  const phone = document.getElementById("phone").value.trim();
  const result = document.getElementById("result");

  if (!phone) {
    result.innerHTML = "âŒ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ";
    return;
  }

  result.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...";

  fetch(API_URL + "?phone=" + encodeURIComponent(phone))
    .then(res => res.json())
    .then(data => {
      if (!data.success) {
        result.innerHTML = "âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ¹Ø§Ù‚Ø¯ Ù…Ø³Ø¬Ù„";
        return;
      }

      const c = data.contract;

      const nextVisit = new Date(c.nextVisit);
      const today = new Date();
      const diffDays = Math.ceil((nextVisit - today) / (1000 * 60 * 60 * 24));

      const waText =
`Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ
Ø£Ø±ØºØ¨ ÙÙŠ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ Ø§Ù„Ø®Ø§Øµ Ø¨ÙŠ Ù„Ø¯Ù‰ FutureTank.
Ø¨Ø±Ø¬Ø§Ø¡ ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
Ø´ÙƒØ±Ø§Ù‹ Ù„Ø­Ø¶Ø±ØªÙƒÙ….`;

      const waLink =
`https://wa.me/201150402031?text=${encodeURIComponent(waText)}`;

      result.innerHTML = `
        <div class="card">
          <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${c.name}</p>
          <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${c.phone}</p>
          <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${c.address}</p>
          <p><strong>Ø§Ù„Ø®Ø¯Ù…Ø©:</strong> ${c.service}</p>
          <p><strong>Ù…Ø¯Ø© Ø§Ù„ØªØ¹Ø§Ù‚Ø¯:</strong> ${c.duration}</p>
          <p><strong>Ø§Ù„ØªÙƒÙ„ÙØ©:</strong> ${c.cost}</p>
          <p><strong>Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©:</strong> ${c.lastVisit}</p>
          <p><strong>Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©:</strong> ${c.nextVisit}</p>
          <p><strong>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:</strong> ${diffDays} ÙŠÙˆÙ…</p>

          ${diffDays <= 7 ? `<a class="whatsapp" target="_blank" href="${waLink}">ğŸ“² ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</a>` : ``}
        </div>
      `;
    })
    .catch(() => {
      result.innerHTML = "âŒ Ø®Ø·Ø£ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…";
    });
}
</script>

</body>
</html>
