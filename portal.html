<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbyAaJxK4VVMzMpavJjXL1HNNWk_cHeRsouj7Jt6pvAg2_tjxIuotItocqEFoWDhKeXh/exec";

function getContract(){
  const phone = document.getElementById("phone").value.trim();
  const result = document.getElementById("result");
  const wa = document.getElementById("wa");

  if(!phone){
    result.textContent = "❌ من فضلك أدخل رقم الهاتف";
    return;
  }

  result.textContent = "⏳ جاري البحث...";
  wa.style.display="none";

  fetch(API_URL + "?phone=" + encodeURIComponent(phone))
    .then(r=>r.json())
    .then(d=>{
      if(d.success){
        result.textContent =
`الاسم: ${d.contract.name}
الهاتف: ${d.contract.phone}
العنوان: ${d.contract.address}
الخدمة: ${d.contract.service}
مدة التعاقد (بالشهور): ${d.contract.duration}
التكلفة: ${d.contract.cost}
آخر زيارة: ${d.contract.lastVisit}
الزيارة القادمة: ${d.contract.nextVisit}
الأيام المتبقية: ${d.contract.daysRemaining ?? "—"} يوم`;

        wa.href =
        "https://wa.me/201150402031?text=" +
        encodeURIComponent(
          "مرحباً، أرغب في تجديد التعاقد الخاص بي لدى FutureTank. برجاء تأكيد التجديد."
        );
        wa.style.display="block";
      }else{
        result.textContent="❌ لا يوجد تعاقد مسجل";
      }
    });
}
</script>
