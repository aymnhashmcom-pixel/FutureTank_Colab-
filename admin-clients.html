<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ â€” FutureTank</title>

<script src="auth.js"></script>
<script>requireRole("admin")</script>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<style>
body{
  font-family:Tahoma;
  background:#f4f9ff;
  padding:20px
}
.box{
  background:#fff;
  padding:20px;
  border-radius:12px;
  max-width:950px;
  margin:auto;
  box-shadow:0 2px 10px rgba(0,0,0,.1)
}
input,select{
  padding:10px;
  margin:5px;
  width:180px
}
button{
  padding:8px 12px;
  margin-top:5px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#0d6efd;
  color:#fff
}
.del{background:#dc3545}
.qr{background:#198754}
.client{
  background:#eef5ff;
  padding:12px;
  border-radius:10px;
  margin-top:10px
}
.qrbox{
  margin-top:10px;
  background:#fff;
  padding:10px;
  display:inline-block;
  border-radius:8px
}
</style>
</head>

<body>

<div class="box">
<h2>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…ØªØ¹Ø§Ù‚Ø¯ÙŠÙ†</h2>

<h3>â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</h3>

<input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
<input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<input id="service" placeholder="Ø§Ù„Ø®Ø¯Ù…Ø©">
<input id="lastVisit" type="date">
<input id="nextVisit" type="date">
<input id="contract" type="date">

<select id="renewMonth">
<option value="">Ø´Ù‡Ø± Ø§Ù„ØªØ¬Ø¯ÙŠØ¯</option>
<option>ÙŠÙ†Ø§ÙŠØ±</option><option>ÙØ¨Ø±Ø§ÙŠØ±</option><option>Ù…Ø§Ø±Ø³</option>
<option>Ø£Ø¨Ø±ÙŠÙ„</option><option>Ù…Ø§ÙŠÙˆ</option><option>ÙŠÙˆÙ†ÙŠÙˆ</option>
<option>ÙŠÙˆÙ„ÙŠÙˆ</option><option>Ø£ØºØ³Ø·Ø³</option><option>Ø³Ø¨ØªÙ…Ø¨Ø±</option>
<option>Ø£ÙƒØªÙˆØ¨Ø±</option><option>Ù†ÙˆÙÙ…Ø¨Ø±</option><option>Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
</select>

<br><br>
<button onclick="addClient()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„</button>

<hr>

<h3>ğŸ“‹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠÙˆÙ†</h3>
<div id="list"></div>
</div>

<script>
const db = JSON.parse(localStorage.getItem("ft_db")||"{}");
db.clients = db.clients || [];

function save(){
  localStorage.setItem("ft_db",JSON.stringify(db));
}

function genCode(){
  return "FT-" + (1000 + db.clients.length + 1);
}

function addClient(){
  db.clients.push({
    code: genCode(),
    name: name.value,
    phone: phone.value,
    service: service.value,
    lastVisit: lastVisit.value,
    nextVisit: nextVisit.value,
    contract: contract.value,
    renew: renewMonth.value
  });
  save();
  location.reload();
}

function remove(i){
  if(confirm("Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ")){
    db.clients.splice(i,1);
    save();
    location.reload();
  }
}

function showQR(code, id){
  const box = document.getElementById(id);
  box.innerHTML="";
  new QRCode(box,{
    text: location.origin + "/client.html?code=" + code,
    width:150,
    height:150
  });
}

function render(){
  const box = document.getElementById("list");
  db.clients.forEach((c,i)=>{
    const id="qr"+i;
    const div=document.createElement("div");
    div.className="client";
    div.innerHTML=`
<b>${c.name}</b> â€” ${c.code}<br>
ğŸ“ ${c.phone}<br>
ğŸ§° ${c.service}<br>
ğŸ“… Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©: ${c.lastVisit || "-"}<br>
ğŸ“† Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${c.nextVisit || "-"}<br>
ğŸ” ØªØ¬Ø¯ÙŠØ¯: ${c.renew || "-"}<br>

<button class="qr" onclick="showQR('${c.code}','${id}')">ğŸ“± Ø¹Ø±Ø¶ QR</button>
<button class="del" onclick="remove(${i})">ğŸ—‘ Ø­Ø°Ù</button>

<div class="qrbox" id="${id}"></div>
`;
    box.appendChild(div);
  });
}
render();
</script>

</body>
  </html>
