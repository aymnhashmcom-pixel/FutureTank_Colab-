<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ‘· Ù„ÙˆØ­Ø© Ø§Ù„ÙØ±ÙŠÙ‚ â€” FutureTank</title>

<style>
body{font-family:Tahoma;background:#f4f9ff;margin:20px}
h2{color:#4a90e2}
table{width:100%;border-collapse:collapse;background:#fff;margin-top:20px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#eef5ff}

.bad{background:#ffe5e5}
.warn{background:#fff3cd}
.good{background:#e8f5e9}

button{
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer
}
.done{background:#4CAF50;color:#fff}
.ws{background:#25D366;color:#fff}
textarea{width:100%;padding:6px}
</style>
</head>

<body>

<h2>ğŸ‘· Ù„ÙˆØ­Ø© Ø§Ù„ÙØ±ÙŠÙ‚ â€” Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´ØºÙ„</h2>

<table>
<thead>
<tr>
  <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
  <th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
  <th>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø©</th>
  <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
  <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
  <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
</tr>
</thead>

<tbody id="ordersBody"></tbody>
</table>

<script src="system.js"></script>
<script>
function daysDiff(date){
  const d = new Date(date);
  const today = new Date();
  return Math.ceil((d - today)/(1000*60*60*24));
}

function renderTeamOrders(){
  const db = loadDB();
  const body = document.getElementById("ordersBody");
  body.innerHTML = "";

  (db.contracts||[]).forEach(c=>{
    const diff = daysDiff(c.nextVisit);
    let cls = "good";
    if(diff < 0) cls="bad";
    else if(diff <=5) cls="warn";

    const msg = encodeURIComponent(
`Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…
Ù†Ø°ÙƒØ±ÙƒÙ… Ø¨Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø©

Ø§Ù„Ø®Ø¯Ù…Ø©: ${c.service}
Ø§Ù„Ø¹Ù…ÙŠÙ„: ${c.client}
ğŸ“… Ø§Ù„Ù…ÙˆØ¹Ø¯: ${c.nextVisit}

ÙØ±ÙŠÙ‚ FutureTank`
    );

    const tr = document.createElement("tr");
    tr.className = cls;

    tr.innerHTML = `
      <td>${c.client}</td>
      <td>${c.service}</td>
      <td>${c.nextVisit}</td>
      <td>${c.status}</td>
      <td><textarea id="n${c.id}">${c.notes||""}</textarea></td>
      <td>
        <button class="done" onclick="execute(${c.id})">âœ” ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°</button>
        <br><br>
        <a href="https://wa.me/2${c.phone}?text=${msg}" target="_blank">
          <button class="ws">ÙˆØ§ØªØ³Ø§Ø¨</button>
        </a>
      </td>
    `;
    body.appendChild(tr);
  });
}

function execute(id){
  const note = document.getElementById("n"+id).value;
  updateExecution(id,"ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°",note);
  alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ†ÙÙŠØ°");
  renderTeamOrders();
}

renderTeamOrders();
</script>

</body>
</html>
