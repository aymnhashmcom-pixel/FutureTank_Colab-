<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ÙØ±ÙŠÙ‚ â€” FutureTank</title>
<style>
body{font-family:Tahoma;background:#f4f9ff;padding:20px}
table{width:100%;background:#fff;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#eef5ff}
button{padding:6px 10px}
.good{color:green}
.bad{color:red}
</style>
</head>

<body>

<script src="auth.js"></script>
<script>
requireRole("team");
</script>

<h2>ğŸ‘· Ù…Ù‡Ø§Ù… Ø§Ù„ÙØ±ÙŠÙ‚</h2>

<table>
<thead>
<tr>
<th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
<th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
<th>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø©</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
<th>ØªÙ†ÙÙŠØ°</th>
</tr>
</thead>
<tbody id="tasks"></tbody>
</table>

<script>
const db = JSON.parse(localStorage.getItem("ft_db")||"{}");
const contracts = db.contracts || [];
const body = document.getElementById("tasks");

contracts.forEach(c=>{
  const tr = document.createElement("tr");
  tr.innerHTML = `
<td>${c.client}</td>
<td>${c.service}</td>
<td>${c.nextVisit}</td>
<td class="${c.status==='ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°'?'good':'bad'}">${c.status}</td>
<td>
<button onclick="execute(${c.id})">ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°</button>
</td>`;
  body.appendChild(tr);
});

function execute(id){
  const db = JSON.parse(localStorage.getItem("ft_db"));
  const c = db.contracts.find(x=>x.id===id);
  if(!c) return;
  c.status="ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°";
  db.logs = db.logs || [];
  db.logs.push({
    client:c.client,
    service:c.service,
    date:new Date().toISOString().split("T")[0]
  });
  localStorage.setItem("ft_db", JSON.stringify(db));
  location.reload();
}
</script>

</body>
</html>
