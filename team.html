<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ‘· Ù„ÙˆØ­Ø© Ø§Ù„ÙØ±ÙŠÙ‚ â€” FutureTank</title>
<style>
body{font-family:Tahoma;background:#f4f9ff;margin:20px}
h2{color:#4a90e2}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#eef5ff}
button{
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer
}
.done{background:#2ecc71;color:#fff}
.note{width:100%;padding:6px}
</style>
</head>

<body>

<h2>ğŸ‘· Ù„ÙˆØ­Ø© Ø§Ù„ÙØ±ÙŠÙ‚ â€” Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´ØºÙ„</h2>

<table>
<thead>
<tr>
  <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
  <th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
  <th>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø©</th>
  <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
  <th>ØªÙ†ÙÙŠØ°</th>
</tr>
</thead>
<tbody id="teamBody"></tbody>
</table>

<script>
const db = JSON.parse(localStorage.getItem("ft_db")||"{}");
db.contracts = db.contracts || [];

const body = document.getElementById("teamBody");

function render(){
  body.innerHTML = "";
  db.contracts.forEach((c,i)=>{
    if(c.status==="ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°") return;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${c.client}</td>
      <td>${c.service}</td>
      <td>${c.nextVisit}</td>
      <td>
        <input class="note" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªÙ†ÙÙŠØ°" 
        onchange="saveNote(${i},this.value)">
      </td>
      <td>
        <button class="done" onclick="markDone(${i})">
          âœ” ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°
        </button>
      </td>
    `;
    body.appendChild(tr);
  });
}

function saveNote(i,val){
  db.contracts[i].note = val;
  localStorage.setItem("ft_db",JSON.stringify(db));
}

function markDone(i){
  const c = db.contracts[i];
  c.status = "ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°";
  c.lastVisit = c.nextVisit;

  const days = Number(c.cycle);
  const next = new Date(c.nextVisit);
  next.setDate(next.getDate()+days);
  c.nextVisit = next.toISOString().split("T")[0];

  db.logs = db.logs || [];
  db.logs.push({
    client:c.client,
    service:c.service,
    date:new Date().toISOString().split("T")[0],
    note:c.note||""
  });

  localStorage.setItem("ft_db",JSON.stringify(db));
  render();
}

render();
</script>

</body>
</html>
