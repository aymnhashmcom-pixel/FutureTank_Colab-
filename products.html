<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />

  <style>
    body { font-family: Tahoma, Arial; background:#f7f7f7; margin:0; padding:20px }
    h1 { text-align:center }
    .products { display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:20px }
    .product { background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,.1) }
    .product h3 { margin:0 0 10px }
    .product button {
      width:100%;
      padding:10px;
      background:#0a7cff;
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-size:16px;
    }
    .popup {
      position:fixed; inset:0;
      background:rgba(0,0,0,.6);
      display:none; align-items:center; justify-content:center;
    }
    .popup-content {
      background:#fff; padding:20px; width:95%; max-width:400px;
      border-radius:10px;
    }
    .popup-content input {
      width:100%; margin-bottom:10px; padding:8px;
    }
  </style>
</head>

<body>

<h1>ğŸ›’ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>

<div class="products" id="products"></div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ù„Ø¨ -->
<div class="popup" id="orderPopup">
  <div class="popup-content">
    <h3 id="selectedProductTitle"></h3>

    <input id="customerName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" />
    <input id="customerPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" />
    <input id="customerAddress" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" />

    <button onclick="confirmOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
    <br><br>
    <button onclick="closePopup()">Ø¥Ù„ØºØ§Ø¡</button>
  </div>
</div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBmWKWIPtVjUYXGOF77Zstmz3ROpvKIDog",
    authDomain: "futuretank-68c26.firebaseapp.com",
    projectId: "futuretank-68c26",
    storageBucket: "futuretank-68c26.firebasestorage.app",
    messagingSenderId: "481083621438",
    appId: "1:481083621438:web:db01077aef0511792c516f"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const productsDiv = document.getElementById("products");
  let selectedProduct = null;

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  const snapshot = await getDocs(collection(db, "products"));
  snapshot.forEach(doc => {
    const p = doc.data();
    const div = document.createElement("div");
    div.className = "product";
    div.innerHTML = `
      <h3>${p.name}</h3>
      <p>Ø§Ù„Ø³Ø¹Ø±: ${p.price} Ø¬Ù†ÙŠÙ‡</p>
      <button onclick='openPopup(${JSON.stringify(p)})'>Ø§Ø´ØªØ±Ù Ø§Ù„Ø¢Ù†</button>
    `;
    productsDiv.appendChild(div);
  });

  // ÙØªØ­ Ø§Ù„Ø·Ù„Ø¨
  window.openPopup = function(product) {
    selectedProduct = product;
    document.getElementById("selectedProductTitle").innerText =
      product.name + " - " + product.price + " Ø¬Ù†ÙŠÙ‡";
    document.getElementById("orderPopup").style.display = "flex";
  };

  window.closePopup = function() {
    document.getElementById("orderPopup").style.display = "none";
  };

  // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
  window.confirmOrder = async function() {
    const name = customerName.value;
    const phone = customerPhone.value;
    const address = customerAddress.value;

    if (!name || !phone || !address) {
      alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
      return;
    }

    await addDoc(collection(db, "orders"), {
      productName: selectedProduct.name,
      price: selectedProduct.price,
      customerName: name,
      customerPhone: phone,
      customerAddress: address,
      status: "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨",
      createdAt: new Date()
    });

    const message = `
Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ğŸ›’
------------------
Ø§Ù„Ù…Ù†ØªØ¬: ${selectedProduct.name}
Ø§Ù„Ø³Ø¹Ø±: ${selectedProduct.price} Ø¬Ù†ÙŠÙ‡

ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}
ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${phone}
ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}

Ø§Ù„Ø­Ø§Ù„Ø©: ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
`;

    const whatsappNumber = "2010XXXXXXXX"; // â† Ø±Ù‚Ù… Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
    const url = "https://wa.me/" + whatsappNumber +
                "?text=" + encodeURIComponent(message);

    window.open(url, "_blank");
    alert("âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨");
    closePopup();
  };
</script>

</body>
</html>
