<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª | FutureTank</title>

  <link rel="stylesheet" href="styles.css">

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      addDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBmWKWIPtVjUYXGOF77Zstmz3ROpvKIDog",
      authDomain: "futuretank-68c26.firebaseapp.com",
      projectId: "futuretank-68c26",
      storageBucket: "futuretank-68c26.firebasestorage.app",
      messagingSenderId: "481083621438",
      appId: "1:481083621438:web:db01077aef0511792c516f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const productsContainer = document.getElementById("products");

    let selectedProduct = {};

    async function loadProducts() {
      const querySnapshot = await getDocs(collection(db, "products"));
      productsContainer.innerHTML = "";

      querySnapshot.forEach(doc => {
        const data = doc.data();

        if (!data.name || !data.price) return;

        const div = document.createElement("div");
        div.className = "product-card";

        div.innerHTML = `
          <h3>${data.name}</h3>
          <p>Ø§Ù„Ø³Ø¹Ø±: ${data.price} Ø¬Ù†ÙŠÙ‡</p>
          <button onclick="buyNow('${data.name}', ${data.price})">
            Ø§Ø´ØªØ±Ù Ø§Ù„Ø¢Ù†
          </button>
        `;

        productsContainer.appendChild(div);
      });
    }

    window.buyNow = function(name, price) {
      selectedProduct = { name, price };

      document.getElementById("popupProductName").innerText =
        "Ø§Ù„Ù…Ù†ØªØ¬: " + name;

      document.getElementById("popupProductPrice").innerText =
        "Ø§Ù„Ø³Ø¹Ø±: " + price + " Ø¬Ù†ÙŠÙ‡";

      document.getElementById("purchasePopup").style.display = "flex";
    };

    window.closePopup = function() {
      document.getElementById("purchasePopup").style.display = "none";
    };

    window.confirmOrder = async function() {
      const customerName = document.getElementById("customerName").value;
      const customerPhone = document.getElementById("customerPhone").value;
      const customerAddress = document.getElementById("customerAddress").value;

      if (!customerName || !customerPhone || !customerAddress) {
        alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        return;
      }

      await addDoc(collection(db, "orders"), {
        productName: selectedProduct.name,
        price: selectedProduct.price,
        customerName,
        customerPhone,
        customerAddress,
        status: "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨",
        createdAt: new Date()
      });

      alert("âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­");
      closePopup();
    };

    loadProducts();
  </script>

  <style>
    body {
      font-family: Tahoma, Arial;
      background: #f5f7fa;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    .products {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 15px;
    }

    .product-card {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,.1);
    }

    .product-card button {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      background: #2a7cff;
      color: #fff;
      border: none;
      cursor: pointer;
      border-radius: 6px;
    }

    /* Popup */
    .popup-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .popup {
      background: #fff;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      border-radius: 12px;
      text-align: center;
    }

    .popup input,
    .popup textarea {
      width: 100%;
      margin: 8px 0;
      padding: 10px;
    }

    .popup button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      background: #2a7cff;
      color: #fff;
      border: none;
      cursor: pointer;
    }

    .popup .close {
      background: #999;
    }
  </style>
</head>

<body>

<h1>ğŸ›’ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>

<div id="products" class="products"></div>

<!-- Popup -->
<div id="purchasePopup" class="popup-overlay">
  <div class="popup">
    <h2>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡</h2>

    <p id="popupProductName"></p>
    <p id="popupProductPrice"></p>

    <input id="customerName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">
    <input id="customerPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
    <textarea id="customerAddress" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"></textarea>

    <button onclick="confirmOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
    <button class="close" onclick="closePopup()">Ø¥Ù„ØºØ§Ø¡</button>
  </div>
</div>

</body>
</html>
