<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ“‹ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´ØºÙ„ â€” FutureTank</title>
<style>
body{font-family:Tahoma;background:#f4f9ff;margin:20px}
h2{color:#4a90e2}
.card{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
.btn{display:inline-block;padding:8px 12px;background:#4a90e2;color:#fff;border-radius:6px;text-decoration:none;margin-top:8px}
</style>
</head>
<body>

<h2>ğŸ“‹ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´ØºÙ„ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©</h2>
<p>Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØªÙ†ÙÙŠØ°Ù‡Ø§ Ø®Ù„Ø§Ù„ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</p>

<div id="orders"></div>

<script>
const data = JSON.parse(localStorage.getItem("ft_contracts")||"[]");
const box = document.getElementById("orders");

function nextVisit(last, cycle){
  const d = new Date(last);
  d.setDate(d.getDate() + Number(cycle));
  return d;
}

const today = new Date();

const due = data.filter(c=>{
  const diff = Math.ceil((nextVisit(c.lastVisit,c.cycle)-today)/(1000*60*60*24));
  return diff <= 5 && diff >= 0;
});

if(due.length===0){
  box.innerHTML="<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± Ø´ØºÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹ âœ…</p>";
}

due.forEach(c=>{
  const visit = nextVisit(c.lastVisit,c.cycle).toISOString().split("T")[0];
  const msg = `
Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…
Ø£Ù…Ø± Ø´ØºÙ„ Ù…Ø¹ØªÙ…Ø¯

Ø§Ù„Ø¹Ù…ÙŠÙ„: ${c.client}
Ø§Ù„Ø®Ø¯Ù…Ø©: ${c.service}
ğŸ“… Ø§Ù„Ù…ÙˆØ¹Ø¯: ${visit}
ğŸ’° Ø§Ù„ØªÙƒÙ„ÙØ©: ${c.cost} Ø¬Ù†ÙŠÙ‡

Ø§Ù„Ø¯ÙØ¹ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†ÙÙŠØ°
Ø§ØªØµØ§Ù„Ø§Øª ÙƒØ§Ø´:
01150402031

FutureTank`;
  const wa = `https://wa.me/2${c.phone}?text=${encodeURIComponent(msg)}`;

  box.innerHTML += `
  <div class="card">
    <b>Ø§Ù„Ø¹Ù…ÙŠÙ„:</b> ${c.client}<br>
    <b>Ø§Ù„Ø®Ø¯Ù…Ø©:</b> ${c.service}<br>
    <b>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø©:</b> ${visit}<br>
    <b>Ø§Ù„ØªÙƒÙ„ÙØ©:</b> ${c.cost} Ø¬Ù†ÙŠÙ‡<br>
    <a class="btn" href="${wa}" target="_blank">ğŸ’¬ Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨</a>
  </div>`;
});
</script>

</body>
</html>
