<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ“„ ØªØµØ¯ÙŠØ± Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´ØºÙ„ PDF â€” FutureTank</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<style>
body{font-family:Tahoma;background:#f4f9ff;margin:20px}
button{padding:12px 18px;background:#4a90e2;color:#fff;border:none;border-radius:8px;font-size:16px;cursor:pointer}
</style>
</head>
<body>

<h2>ğŸ“„ ØªØµØ¯ÙŠØ± Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´ØºÙ„ (PDF Ù…ÙØ¬Ù…Ù‘Ø¹)</h2>
<button onclick="generatePDF()">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ PDF</button>

<script>
const { jsPDF } = window.jspdf;

function nextVisit(last, cycle){
  const d = new Date(last);
  d.setDate(d.getDate() + Number(cycle));
  return d;
}

function generatePDF(){
  const data = JSON.parse(localStorage.getItem("ft_contracts")||"[]");
  const today = new Date();

  const orders = data.filter(c=>{
    const diff = Math.ceil((nextVisit(c.lastVisit,c.cycle)-today)/(1000*60*60*24));
    return diff <= 5 && diff >= 0;
  });

  if(orders.length===0){
    alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± Ø´ØºÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹");
    return;
  }

  const pdf = new jsPDF({orientation:"portrait", unit:"mm", format:"a4"});

  orders.forEach((c,i)=>{
    if(i>0) pdf.addPage();

    pdf.setFont("Helvetica","bold");
    pdf.setFontSize(16);
    pdf.text("FutureTank", 105, 20, {align:"center"});

    pdf.setFontSize(12);
    pdf.text("Ø£Ù…Ø± Ø´ØºÙ„ Ø±Ø³Ù…ÙŠ", 105, 30, {align:"center"});

    pdf.setFont("Helvetica","normal");
    pdf.text(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toISOString().split("T")[0]}`, 15, 40);

    const visit = nextVisit(c.lastVisit,c.cycle).toISOString().split("T")[0];

    pdf.autoTable({
      startY: 50,
      styles:{halign:"right", font:"Helvetica"},
      head:[["Ø§Ù„Ø¨ÙŠØ§Ù†","Ø§Ù„ØªÙØ§ØµÙŠÙ„"]],
      body:[
        ["Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„", c.client],
        ["Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ", c.phone],
        ["Ø§Ù„Ø®Ø¯Ù…Ø©", c.service],
        ["Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø©", visit],
        ["ØªÙƒÙ„ÙØ© Ø§Ù„Ø²ÙŠØ§Ø±Ø©", c.cost + " Ø¬Ù†ÙŠÙ‡"],
        ["Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹", "Ø§ØªØµØ§Ù„Ø§Øª ÙƒØ§Ø´ â€” 01150402031"],
        ["Ù…Ù„Ø§Ø­Ø¸Ø©", "ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¹Ù‚Ø¨ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ù…Ø¨Ø§Ø´Ø±Ø©"]
      ]
    });

    pdf.text("ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„: ____________________", 15, 260);
    pdf.text("ÙØ±ÙŠÙ‚ FutureTank", 150, 260);
  });

  pdf.save("FutureTank_Work_Orders.pdf");
}
</script>

</body>
</html>
