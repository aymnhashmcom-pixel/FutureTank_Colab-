<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ“„ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ â€” FutureTank</title>

<style>
body{
  font-family:Tahoma;
  background:#f4f9ff;
  padding:20px
}
.box{
  background:#fff;
  max-width:600px;
  margin:auto;
  padding:20px;
  border-radius:12px;
  box-shadow:0 2px 10px rgba(0,0,0,.1)
}
h2{color:#0d6efd}
.info{
  background:#eef5ff;
  padding:12px;
  border-radius:8px;
  margin-bottom:10px
}
button{
  width:100%;
  padding:12px;
  margin-top:15px;
  background:#4caf50;
  border:none;
  border-radius:6px;
  color:#fff;
  font-size:16px;
  cursor:pointer
}
</style>
</head>

<body>

<div class="box" id="app"></div>

<script>
const PHONE = "01150402031";
const WA = "201150402031";

const params = new URLSearchParams(location.search);
const code = params.get("code");

const db = JSON.parse(localStorage.getItem("ft_db")||"{}");
db.clients ||= [];
const client = db.clients.find(c=>c.code===code);

const app = document.getElementById("app");

if(!client){
  app.innerHTML="<h3>âŒ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©</h3>";
}else{

  const now = new Date();
  const renew = client.renewDate ? new Date(client.renewDate) : null;
  const needRenew = renew && renew.getMonth()===now.getMonth();

  app.innerHTML = `
    <h2>ğŸ“„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</h2>

    <div class="info">ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${client.name}</div>
    <div class="info">ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${client.phone}</div>
    <div class="info">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹Ø§Ù‚Ø¯: ${client.startDate || "â€”"}</div>
    <div class="info">ğŸ”„ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¬Ø¯ÙŠØ¯: ${client.renewDate || "â€”"}</div>
    <div class="info">ğŸ›  Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©: ${client.lastVisit || "â€”"}</div>
    <div class="info">ğŸ“† Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${client.nextVisit || "â€”"}</div>

    ${needRenew ? `<button onclick="renew()">ğŸ” ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</button>` : ""}
    ${!client.startDate ? `<button onclick="newContract()">âœï¸ ØªØ¹Ø§Ù‚Ø¯ Ø§Ù„Ø¢Ù†</button>` : ""}
  `;
}

function renew(){
  client.renewDate = new Date(new Date().setFullYear(new Date().getFullYear()+1))
                     .toISOString().split("T")[0];
  localStorage.setItem("ft_db",JSON.stringify(db));

  notify("ØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯");
}

function newContract(){
  client.startDate = new Date().toISOString().split("T")[0];
  client.renewDate = new Date(new Date().setFullYear(new Date().getFullYear()+1))
                     .toISOString().split("T")[0];
  localStorage.setItem("ft_db",JSON.stringify(db));

  notify("ØªÙ… Ø¥Ø¨Ø±Ø§Ù… ØªØ¹Ø§Ù‚Ø¯ Ø¬Ø¯ÙŠØ¯");
}

function notify(msg){
  const text = `${msg}\nØ§Ù„Ø¹Ù…ÙŠÙ„: ${client.name}\nÙƒÙˆØ¯: ${client.code}`;
  const link = `https://wa.me/${WA}?text=${encodeURIComponent(text)}`;
  window.open(link,"_blank");
  alert("âœ… ØªÙ… Ø¨Ù†Ø¬Ø§Ø­");
}
</script>

</body>
</html>
