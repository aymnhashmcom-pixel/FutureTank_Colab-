<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</title>
  <link rel="stylesheet" href="styles.css">

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      deleteDoc,
      doc
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBmWKWIPtVjUYXGOF77Zstmz3ROpvKIDog",
      authDomain: "futuretank-68c26.firebaseapp.com",
      projectId: "futuretank-68c26",
      storageBucket: "futuretank-68c26.firebasestorage.app",
      messagingSenderId: "481083621438",
      appId: "1:481083621438:web:db01077aef0511792c516f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const customersCol = collection(db, "customers");

    // Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„
    window.addCustomer = async function () {
      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const email = document.getElementById("email").value.trim();
      const address = document.getElementById("address").value.trim();
      const price = document.getElementById("price").value;
      const start = document.getElementById("start").value;
      const end = document.getElementById("end").value;
      const lastVisit = document.getElementById("lastVisit").value;
      const nextVisit = document.getElementById("nextVisit").value;
      const status = document.getElementById("status");

      if (!name || !phone || !price || !start || !end) {
        status.textContent = "âŒ Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©";
        return;
      }

      try {
        await addDoc(customersCol, {
          name,
          phone,
          email,
          address,
          price,
          start,
          end,
          lastVisit,
          nextVisit,
          createdAt: new Date()
        });

        status.textContent = "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­";
        document.querySelectorAll("input").forEach(i => i.value = "");
        loadCustomers();
      } catch (e) {
        status.textContent = "âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©";
        console.error(e);
      }
    };

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
    async function loadCustomers() {
      const list = document.getElementById("customersList");
      list.innerHTML = "";

      const snap = await getDocs(customersCol);
      snap.forEach(d => {
        const c = d.data();
        const div = document.createElement("div");
        div.className = "card";

        div.innerHTML = `
          <b>${c.name}</b><br>
          ğŸ“ ${c.phone}<br>
          ğŸ“§ ${c.email || "â€”"}<br>
          ğŸ“ ${c.address || "â€”"}<br>
          ğŸ’° ${c.price} Ø¬Ù†ÙŠÙ‡<br>
          ğŸ“… ${c.start} â†’ ${c.end}<br>
          ğŸ›  Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©: ${c.lastVisit || "â€”"}<br>
          ğŸ“ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${c.nextVisit || "â€”"}<br>
          <button onclick="deleteCustomer('${d.id}')">ğŸ—‘ Ø­Ø°Ù</button>
        `;
        list.appendChild(div);
      });
    }

    // Ø­Ø°Ù Ø¹Ù…ÙŠÙ„
    window.deleteCustomer = async function (id) {
      if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) return;
      await deleteDoc(doc(db, "customers", id));
      loadCustomers();
    };

    window.onload = loadCustomers;
  </script>
</head>

<body>

<h2>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>

<div class="card">
  <h3>â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</h3>

  <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
  <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
  <input id="email" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
  <input id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
  <input id="price" type="number" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ¹Ø§Ù‚Ø¯">

  <label>ğŸ“… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</label>
  <input id="start" type="date">

  <label>ğŸ“… Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</label>
  <input id="end" type="date">

  <label>ğŸ›  Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©</label>
  <input id="lastVisit" type="date">

  <label>ğŸ“ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</label>
  <input id="nextVisit" type="date">

  <button onclick="addCustomer()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
  <p id="status"></p>
</div>

<h3>ğŸ“‹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†</h3>
<div id="customersList"></div>

</body>
</html>
