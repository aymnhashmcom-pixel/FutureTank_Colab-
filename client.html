<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ â€” FutureTank</title>
<style>
body{font-family:Tahoma;background:#f4f9ff;padding:20px}
.card{
  background:#fff;
  padding:20px;
  border-radius:10px;
  max-width:600px;
  margin:auto;
  box-shadow:0 2px 6px rgba(0,0,0,.15)
}
.item{margin:8px 0}
button{
  padding:10px 14px;
  border:none;
  border-radius:8px;
  background:#4caf50;
  color:#fff;
  cursor:pointer;
  margin-top:10px
}
.logout{background:#e53935}
</style>
</head>

<body>

<div class="card" id="card"></div>

<script>
const key = sessionStorage.getItem("client_key");
if(!key) location.href="client-login.html";

fetch("database.json")
.then(r=>r.json())
.then(db=>{
  const clients = db.clients || [];
  const c = clients.find(x =>
    x.code==key || x.phone==key
  );

  if(!c){
    card.innerHTML="âŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
    return;
  }

  card.innerHTML=`
    <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ ${c.name}</h2>
    <div class="item">ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${c.phone}</div>
    <div class="item">ğŸ§° Ø§Ù„Ø®Ø¯Ù…Ø©: ${c.service}</div>
    <div class="item">ğŸ“… Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©: ${c.lastVisit}</div>
    <div class="item">â­ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${c.nextVisit}</div>
    <div class="item">ğŸ’° Ø§Ù„ØªÙƒÙ„ÙØ©: ${c.cost} Ø¬Ù†ÙŠÙ‡</div>
    <div class="item">ğŸ“„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø§Ù‚Ø¯: ${c.renewDate}</div>

    ${
      isRenewMonth(c.renewDate)
      ? `<button onclick="renew()">ğŸ” ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</button>`
      : ""
    }

    <button class="logout" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
  `;
});

function isRenewMonth(d){
  const m = new Date(d).getMonth();
  return m === new Date().getMonth();
}

function renew(){
  const wa="201150402031";
  window.open(
    `https://wa.me/${wa}?text=Ø§Ù„Ø¹Ù…ÙŠÙ„%20ÙŠØ±ØºØ¨%20ÙÙŠ%20ØªØ¬Ø¯ÙŠØ¯%20Ø§Ù„ØªØ¹Ø§Ù‚Ø¯`,
    "_blank"
  );
}

function logout(){
  sessionStorage.clear();
  location.href="client-login.html";
}
</script>

</body>
</html>
