<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ â€“ FutureTank</title>

<style>
body{font-family:Tahoma;background:#f4f9ff;padding:20px}
h2{text-align:center;color:#0077b6}
input,button{
  width:100%;padding:10px;margin:6px 0;
  border-radius:6px;border:1px solid #ccc
}
button{background:#0077b6;color:#fff;font-size:15px;cursor:pointer}
.card{
  background:#fff;padding:15px;border-radius:8px;
  margin-top:15px;box-shadow:0 2px 6px rgba(0,0,0,.1)
}
.alert{background:#fffae6;padding:10px;border-radius:6px;margin:10px 0}
</style>
</head>

<body>

<h2>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>

<input id="loginValue" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„">
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>

<div id="result"></div>

<script>
const PHONE = "01150402031";
const WHATSAPP = "201150402031";

function loadDB(){
  return JSON.parse(localStorage.getItem("ft_db") || "{}");
}
function saveDB(db){
  localStorage.setItem("ft_db",JSON.stringify(db));
}

function login(){
  const val = loginValue.value.trim();
  if(!val){ alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"); return; }

  const db = loadDB();
  const client = db.clients?.find(c=>c.phone===val || String(c.id)===val);
  if(!client){ alert("Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"); return; }

  const today = new Date();
  const end = new Date(client.end);
  const diffDays = Math.ceil((end - today)/(1000*60*60*24));

  document.getElementById("result").innerHTML = `
    <div class="card">
      <h3>ğŸ‘¤ ${client.name}</h3>
      <p>ğŸ“ ${client.phone}</p>
      <p>ğŸ’° ${client.cost} Ø¬Ù†ÙŠÙ‡</p>
      <p>ğŸ“… Ø§Ù„ØªØ¹Ø§Ù‚Ø¯: ${client.start} â†’ ${client.end}</p>
      <p>ğŸ›  Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©: ${client.lastVisit}</p>
      <p>ğŸ“ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${client.nextVisit}</p>

      ${diffDays <= 10 ? `
        <div class="alert">
          âš ï¸ Ù…ØªØ¨Ù‚ÙŠ ${diffDays} Ø£ÙŠØ§Ù… Ø¹Ù„Ù‰ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯
        </div>
        <button onclick="renew('${client.phone}')">
          ğŸ”„ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ Ø§Ù„Ø¢Ù†
        </button>
      ` : ``}
    </div>
  `;
}

function renew(phone){
  if(!confirm("ØªØ£ÙƒÙŠØ¯ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ØŸ")) return;

  const db = loadDB();
  const client = db.clients.find(c=>c.phone===phone);

  const oldEnd = new Date(client.end);
  const newEnd = new Date(oldEnd);
  newEnd.setFullYear(newEnd.getFullYear()+1);

  const today = new Date().toISOString().split("T")[0];
  client.end = newEnd.toISOString().split("T")[0];

  if(!client.renewals) client.renewals=[];
  client.renewals.push({date:today,newEnd:client.end});

  saveDB(db);

  const msg = `
ØªÙ… ØªØ¬Ø¯ÙŠØ¯ ØªØ¹Ø§Ù‚Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„:
${client.name}
ğŸ“ ${client.phone}
ğŸ—“ Ø­ØªÙ‰ ${client.end}
FutureTank
  `;

  window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`);

  alert("âœ… ØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ Ø¨Ù†Ø¬Ø§Ø­");
  location.reload();
}
</script>

</body>
</html>
