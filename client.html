<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</title>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

<style>
body{font-family:Arial;direction:rtl;background:#f5f5f5;padding:20px}
.card{background:#fff;padding:20px;border-radius:10px;max-width:420px;margin:auto}
input,button{width:100%;padding:10px;margin:8px 0}
.green{background:#25D366;color:#fff;border:none;border-radius:6px}
</style>
</head>

<body>

<div class="card">
<h3>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
<input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<button class="green" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
<div id="data"></div>
</div>

<script>
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore,
  collection,
  query,
  where,
  getDocs,
  addDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "futuretank-68c26.firebaseapp.com",
  projectId: "futuretank-68c26"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let clientData = null;

function nextVisit(){
  const d = new Date();
  d.setMonth(d.getMonth() + 3);
  return d.toISOString().split("T")[0];
}

async function login(){
  const phone = document.getElementById("phone").value.trim();
  const box = document.getElementById("data");

  const q = query(collection(db,"clients"), where("phone","==",phone));
  const snap = await getDocs(q);

  if(snap.empty){
    box.innerHTML = "âŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø³Ø¬Ù„";
    return;
  }

  clientData = snap.docs[0].data();

  box.innerHTML = `
    <p>Ù…Ø±Ø­Ø¨Ù‹Ø§ ${clientData.name}</p>
    <button class="green" onclick="renew()">ğŸ” ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</button>
  `;
}

async function renew(){
  await addDoc(collection(db,"contracts"),{
    clientName: clientData.name,
    phone: clientData.phone,
    service: "ØªØ¬Ø¯ÙŠØ¯ ØªØ¹Ø§Ù‚Ø¯",
    price: clientData.price || 0,
    startDate: new Date().toISOString().split("T")[0],
    nextVisit: nextVisit(),
    status: "active",
    createdAt: serverTimestamp(),
    source: "client-portal"
  });

  alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯");
}
</script>

</body>
</html>
