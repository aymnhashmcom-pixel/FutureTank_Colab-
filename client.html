<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;direction:rtl;background:#f5f5f5;padding:20px}
.card{background:#fff;padding:20px;border-radius:10px;max-width:420px;margin:auto}
input,button{width:100%;padding:10px;margin:8px 0}
button{border:none;border-radius:6px}
.green{background:#25D366;color:#fff}
.gray{background:#ccc}
</style>
</head>

<body>

<div class="card">
<h3>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>

<input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
<button class="green" onclick="login()">Ø¯Ø®ÙˆÙ„</button>

<div id="data"></div>
</div>

<script>
firebase.initializeApp({
  apiKey: "PUT_YOUR_KEY",
  authDomain: "futuretank-68c26.firebaseapp.com",
  projectId: "futuretank-68c26"
});

const db = firebase.firestore();

let currentClient=null;

async function login(){
  const phone=document.getElementById("phone").value.trim();
  const box=document.getElementById("data");
  box.innerHTML="â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...";

  const snap=await db.collection("clients")
    .where("phone","==",phone).get();

  if(snap.empty){
    box.innerHTML="âŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø³Ø¬Ù„";
    return;
  }

  currentClient=snap.docs[0].data();

  box.innerHTML=`
    <h4>ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
    <b>Ø§Ù„Ø§Ø³Ù…:</b> ${currentClient.name}<br>
    <b>Ø§Ù„Ù‡Ø§ØªÙ:</b> ${currentClient.phone}<br>
    <b>Ø§Ù„ØªÙƒÙ„ÙØ©:</b> ${currentClient.price||0} Ø¬Ù†ÙŠÙ‡<br>
    <b>Ù…Ø¯Ø© Ø§Ù„ØªØ¹Ø§Ù‚Ø¯:</b> ${currentClient.start||"â€”"} â†’ ${currentClient.end||"â€”"}<br>
    <b>Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©:</b> ${currentClient.lastVisit||"â€”"}<br>
    <b>Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©:</b> ${currentClient.nextVisit||"â€”"}<br><br>

    <button class="green" onclick="renew()">ğŸ”„ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</button>
    <a target="_blank"
       href="https://wa.me/201150402031?text=Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù…ÙŠÙ„: ${currentClient.name}">
       <button class="gray">ğŸ’¬ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
    </a>
  `;
}

async function renew(){
  if(!confirm("ØªØ£ÙƒÙŠØ¯ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ØŸ")) return;

  await db.collection("contracts").add({
    clientName: currentClient.name,
    clientPhone: currentClient.phone,
    type: "renew",
    price: currentClient.price || 0,
    startDate: new Date().toISOString().slice(0,10),
    createdAt: new Date()
  });

  window.open(
    "https://wa.me/201150402031?text=ğŸ”” ØªÙ… ØªØ¬Ø¯ÙŠØ¯ ØªØ¹Ø§Ù‚Ø¯\nØ§Ù„Ø§Ø³Ù…: "
    +currentClient.name+"\nØ§Ù„Ù‡Ø§ØªÙ: "+currentClient.phone,
    "_blank"
  );

  alert("âœ… ØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ Ø¨Ù†Ø¬Ø§Ø­");
}
</script>

</body>
</html>
