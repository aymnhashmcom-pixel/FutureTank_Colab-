<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø¹Ù…Ù„Ø§Ø¡ FutureTank</title>
<link rel="stylesheet" href="styles.css">
<style>
body{font-family:Tahoma;background:#f4f9ff;padding:20px}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
input,button{padding:10px;width:100%;margin-top:8px}
button{border:0;border-radius:6px;cursor:pointer}
.login{background:#007bff;color:#fff}
.renew{background:#4caf50;color:#fff;margin-top:10px}
</style>
</head>

<body>

<h2>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ â€” FutureTank</h2>

<div class="card">
  <input id="loginValue" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„">
  <button class="login" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="result"></div>

<script src="system.js"></script>
<script>
const PHONE="01150402031";
const WA="201150402031";

async function login(){
  const v=document.getElementById("loginValue").value.trim();
  if(!v) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

  const db=await loadDB();
  const client=db.clients.find(c=>c.code===v||c.phone===v);
  if(!client) return alert("Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");

  const contracts=getContractsByClient(client.code);
  const box=document.getElementById("result");

  box.innerHTML=`
  <div class="card">
    <h3>${client.name}</h3>
    ğŸ“± ${client.phone}<br>
    ğŸ” ${client.code}
  </div>`;

  contracts.forEach(c=>{
    const btn=isRenewDue(c)
      ? `<button class="renew" onclick="renew('${c.contractId}')">ğŸ”„ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</button>`
      : "";

    box.innerHTML+=`
    <div class="card">
      ğŸ§° ${c.service}<br>
      ğŸ“… Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©: ${c.lastVisit}<br>
      ğŸ“… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${c.nextVisit}<br>
      ğŸ’° ${c.cost} Ø¬Ù†ÙŠÙ‡<br>
      ğŸ“† ØªØ¬Ø¯ÙŠØ¯: ${c.renewDate}<br>
      ${btn}
    </div>`;
  });
}

function renew(id){
  if(!confirm("Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ØŸ")) return;

  const c=renewContract(id);

  const msg=`ØªÙ… ØªØ¬Ø¯ÙŠØ¯ ØªØ¹Ø§Ù‚Ø¯ Ø®Ø¯Ù…Ø© ${c.service}%0AØ±Ù‚Ù… Ø§Ù„ØªØ¹Ø§Ù‚Ø¯: ${id}`;

  window.open(`https://wa.me/${WA}?text=${msg}`,"_blank");
  window.open(`https://wa.me/${WA}?text=ğŸ”” Ø·Ù„Ø¨ ØªØ¬Ø¯ÙŠØ¯ ØªØ¹Ø§Ù‚Ø¯ Ø¬Ø¯ÙŠØ¯`,"_blank");

  alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
}
</script>

</body>
</html>
