<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;direction:rtl;background:#f5f5f5;padding:20px}
.card{background:#fff;padding:20px;border-radius:10px;max-width:420px;margin:auto}
input,button{width:100%;padding:10px;margin:8px 0}
.green{background:#25D366;color:#fff;border:none;border-radius:6px}
</style>
</head>

<body>

<div class="card">
<h3>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
<input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<button class="green" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
<div id="data"></div>
</div>

<script>
firebase.initializeApp({
  apiKey: "API_KEY",
  authDomain: "futuretank-68c26.firebaseapp.com",
  projectId: "futuretank-68c26"
});

const db = firebase.firestore();
let client = null;

function nextVisit(){
  const d = new Date();
  d.setMonth(d.getMonth() + 3);
  return d.toISOString().split("T")[0];
}

async function login(){
  const phone = document.getElementById("phone").value.trim();
  const box = document.getElementById("data");

  const snap = await db.collection("clients")
    .where("phone","==",phone).get();

  if(snap.empty){
    box.innerHTML = "âŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø³Ø¬Ù„";
    return;
  }

  client = snap.docs[0].data();

  box.innerHTML = `
    <p>Ù…Ø±Ø­Ø¨Ù‹Ø§ ${client.name}</p>
    <button class="green" onclick="renew()">ğŸ” ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</button>
  `;
}

function renew(){
  db.collection("contracts").add({
    clientName: client.name,
    phone: client.phone,
    service: "ØªØ¬Ø¯ÙŠØ¯ ØªØ¹Ø§Ù‚Ø¯",
    price: client.price || 0,
    startDate: new Date().toISOString().split("T")[0],
    nextVisit: nextVisit(),
    status: "active",
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    source: "client_portal"
  }).then(()=>{
    alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯");
  });
}
</script>

</body>
</html>
