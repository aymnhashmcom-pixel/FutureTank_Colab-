<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø¹Ù…Ù„Ø§Ø¡ FutureTank</title>
<link rel="stylesheet" href="styles.css">
<style>
body{
  font-family:Tahoma;
  background:#f4f9ff;
  padding:20px
}
.card{
  background:#fff;
  padding:15px;
  border-radius:8px;
  margin-bottom:15px;
  box-shadow:0 2px 6px rgba(0,0,0,.1)
}
input,button{
  padding:10px;
  width:100%;
  margin-top:8px
}
button{
  background:#007bff;
  color:#fff;
  border:0;
  border-radius:6px;
  cursor:pointer
}
.renew{
  background:#4caf50;
  margin-top:10px
}
</style>
</head>

<body>

<h2>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ â€” FutureTank</h2>

<div class="card">
  <input id="loginValue" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="result"></div>

<script src="system.js"></script>
<script>
async function login(){
  const val = document.getElementById("loginValue").value.trim();
  if(!val) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

  const db = await loadDB();

  let client = db.clients.find(c =>
    c.code === val || c.phone === val
  );

  if(!client){
    alert("Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
    return;
  }

  const contracts = getContractsByClient(client.code);

  const box = document.getElementById("result");
  box.innerHTML = `
    <div class="card">
      <h3>ğŸ‘¤ ${client.name}</h3>
      <p>ğŸ“± ${client.phone}</p>
      <p>ğŸ” ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${client.code}</p>
    </div>
  `;

  if(contracts.length === 0){
    box.innerHTML += `<div class="card">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù‚ÙˆØ¯</div>`;
    return;
  }

  contracts.forEach(c=>{
    const renewBtn = isRenewDue(c)
      ? `<button class="renew"
           onclick="renew('${c.contractId}')">
           ğŸ”„ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯
         </button>`
      : "";

    box.innerHTML += `
      <div class="card">
        <b>ğŸ§° Ø§Ù„Ø®Ø¯Ù…Ø©:</b> ${c.service}<br>
        <b>ğŸ“… Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©:</b> ${c.lastVisit}<br>
        <b>ğŸ“… Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©:</b> ${c.nextVisit}<br>
        <b>ğŸ’° Ø§Ù„ØªÙƒÙ„ÙØ©:</b> ${c.cost} Ø¬Ù†ÙŠÙ‡<br>
        <b>ğŸ“† ØªØ¬Ø¯ÙŠØ¯:</b> ${c.renewDate}<br>
        ${renewBtn}
      </div>
    `;
  });
}

function renew(contractId){
  alert(
    "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯.\n" +
    "Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨."
  );

  // Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©:
  // Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ + ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
}
</script>

</body>
</html>
