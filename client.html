<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ â€” FutureTank</title>
<style>
body{
  font-family:Tahoma;
  background:#f4f9ff;
  padding:20px
}
.card{
  background:#fff;
  max-width:500px;
  margin:auto;
  padding:20px;
  border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,.15)
}
h2{text-align:center}
.row{margin:8px 0}
.label{font-weight:bold;color:#555}
.value{margin-top:3px}
.btn{
  display:block;
  width:100%;
  padding:10px;
  margin-top:10px;
  border:none;
  border-radius:6px;
  font-size:15px;
  cursor:pointer
}
.renew{background:#ff9800;color:#fff}
.new{background:#4caf50;color:#fff}
.back{background:#607d8b;color:#fff}
</style>
</head>

<body>

<div class="card" id="box">
  <h2>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
  <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒâ€¦</p>
</div>

<script>
const WHATSAPP = "201150402031";
const params = new URLSearchParams(location.search);
const key = params.get("key");

const db = JSON.parse(localStorage.getItem("ft_db") || "{}");
db.clients = db.clients || [];

// ====== Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ ======
const client = db.clients.find(c => c.code == key || c.phone == key);

const box = document.getElementById("box");

if(!client){
  box.innerHTML = `
    <h3>âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª</h3>
    <p>ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</p>
    <button class="btn back" onclick="location.href='index.html'">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
  `;
}else{

  const today = new Date().toISOString().slice(0,10);
  const expired = client.contractEnd < today;

  box.innerHTML = `
    <h2>ğŸ‘¤ ${client.name}</h2>

    <div class="row"><div class="label">ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</div><div class="value">${client.phone}</div></div>
    <div class="row"><div class="label">ğŸ“… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</div><div class="value">${client.contractStart}</div></div>
    <div class="row"><div class="label">ğŸ“… Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</div><div class="value">${client.contractEnd}</div></div>
    <div class="row"><div class="label">ğŸ›  Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©</div><div class="value">${client.lastVisit || "â€”"}</div></div>
    <div class="row"><div class="label">ğŸ“ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</div><div class="value">${client.nextVisit || "â€”"}</div></div>
    <div class="row"><div class="label">ğŸ’° Ø§Ù„ØªÙƒÙ„ÙØ©</div><div class="value">${client.price} Ø¬Ù†ÙŠÙ‡</div></div>

    ${expired ? `
      <button class="btn renew" onclick="renew()">ğŸ”„ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</button>
    ` : ``}

    <button class="btn back" onclick="location.href='index.html'">â¬…ï¸ Ø®Ø±ÙˆØ¬</button>
  `;
}

function renew(){
  const msg = `Ø§Ù„Ø¹Ù…ÙŠÙ„ ${client.name} (${client.phone}) ÙŠØ±ØºØ¨ ÙÙŠ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯`;
  window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`,"_blank");
}
</script>

</body>
</html>
