<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ูุณุงุนุฏ ูููุชุดุฑ ุชุงูู โ FutureTank Assistant</title>
<link rel="stylesheet" href="styles.css">
<script src="system.js" defer></script>
</head>
<body class="assistant-page">
<div class="assistant-container container">
  <header><h2>๐ค ุงููุณุงุนุฏ ุงูุฐูู โ ูููุชุดุฑ ุชุงูู</h2></header>
  <div id="chatMessages" class="chat-messages" aria-live="polite"></div>
  <div class="chat-controls">
    <input id="chatInput" placeholder="ุงูุชุจ ุณุคุงูู ููุง..." />
    <button id="chatSend">ุฅุฑุณุงู</button>
    <button id="playWelcome">๐ ุชุดุบูู ุฑุณุงูุฉ ุงูุชุฑุญูุจ</button>
  </div>
</div>

<script>
(function(){
  function loadDB(){ return JSON.parse(localStorage.getItem('ft_db') || '{}'); }
  function append(who, text){
    const messages = document.getElementById('chatMessages');
    const d = document.createElement('div'); d.className = 'msg '+(who==='user'?'u':'b');
    d.innerText = (who==='user'?'ุฃูุช: ':'ุงููุณุงุนุฏ: ')+text;
    messages.appendChild(d); messages.scrollTop = messages.scrollHeight;
  }
  function knowledgeReply(q){
    const db = loadDB();
    const t = q.toLowerCase();
    if(t.includes('ุฎุฏูุงุช') || t.includes('ูุง ูู ุฎุฏูุงุช')) {
      return (db.services && db.services.length) ? db.services.map(s=>s.name).join(' โ ') : 'ุชูุฑูุฏ/ุชุฑููุจ/ุตูุงูุฉ/ุชุนููู';
    }
    if(t.includes('ููุชุฌ') || t.includes('ูุง ูู ุงูููุชุฌุงุช')){
      return (db.products && db.products.length) ? db.products.map(p=>p.name).join(' โ ') : 'ุฎุฒุงูุงุช ูููุงุชุฑ';
    }
    if(t.includes('ุงุญุฌุฒ') || t.includes('ุญุฌุฒ')){
      return 'ููุญุฌุฒ ุงุณุชุฎุฏู ุฒุฑ "ุงุญุฌุฒ ุฎุฏูุฉ ุงูุขู" ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ุฃู ุงุชุตู 01150402031';
    }
    if((t.includes('ููู') && t.includes('ุงุฏูุน')) || t.includes('ุทุฑููุฉ ุงูุฏูุน')){
      return 'ุทุฑููุฉ ุงูุฏูุน: ุงุชุตุงูุงุช ูุงุด ุนูู ุฑูู 01150402031';
    }
    if(t.includes('ุงุชุตุงู')||t.includes('ูุงุชุณ')){
      return 'ูุงุชู/ูุงุชุณุงุจ: 01150402031';
    }
    if(t.includes('ุงุณู')||t.includes('ูู ุงูุชู')||t.includes('ูู ุงูุช')){
      return 'ูููุชุดุฑ ุชุงูู โ ุดุฑูุฉ ูุชุฎุตุตุฉ ูู ุฎุฒุงูุงุช ุงูููุงู ูููุงุชุฑ ุงูููุงู.';
    }
    return (db.aiFallback && db.aiFallback.reply) || 'ุฃูุง ููุง ูููุณุงุนุฏุฉ โ ุงุณุฃููู ุนู: ุงูุฎุฏูุงุชุ ุงูููุชุฌุงุชุ ุงูุญุฌุฒุ ุฃู ุทุฑู ุงูุฏูุน.';
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    append('bot','ุฃูุง ููุง ูููุณุงุนุฏุฉ โ ุงุณุฃููู ุนู: ุงูุฎุฏูุงุชุ ุงูููุชุฌุงุชุ ุงูุญุฌุฒุ ุฃู ุทุฑู ุงูุฏูุน.');
    const input = document.getElementById('chatInput');
    document.getElementById('chatSend').addEventListener('click', ()=>{
      const q = input.value.trim(); if(!q) return;
      append('user', q); input.value='';
      setTimeout(()=> append('bot', knowledgeReply(q)), 300);
    });
    document.getElementById('playWelcome').addEventListener('click', ()=>{
      const db = loadDB(); const txt = db.welcome || 'ุฃููุงู ุจูู ูู ูููุชุดุฑุชุงูู. ููุงุก ุงููุงุก ูู ูุฏููุง. ููู ุฃุณุงุนุฏู ุงููููุ';
      if('speechSynthesis' in window){
        const u = new SpeechSynthesisUtterance(txt); u.lang='ar-SA'; speechSynthesis.cancel(); speechSynthesis.speak(u);
      } else alert('ุงููุชุตูุญ ูุง ูุฏุนู ุชุญููู ุงููุต ูุตูุช.');
    });
    document.getElementById('chatInput').addEventListener('keydown', e=>{ if(e.key==='Enter') document.getElementById('chatSend').click(); });
  });
})();
</script>
</body>
</html>
