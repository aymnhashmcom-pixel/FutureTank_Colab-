<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ´ØºÙŠÙ„ â€” FutureTank</title>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

<style>
body{font-family:Tahoma;background:#f4f9ff;margin:20px}
h2{color:#4a90e2}
button{padding:10px 15px;border:none;border-radius:8px;background:#4a90e2;color:#fff;cursor:pointer;margin-bottom:15px}

.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:15px;
  margin-bottom:25px
}
.card{
  background:#fff;
  padding:15px;
  border-radius:10px;
  text-align:center;
  box-shadow:0 4px 10px rgba(0,0,0,.1)
}
.card h3{margin:0;font-size:14px}
.card p{font-size:22px;font-weight:bold;margin:8px 0;color:#4a90e2}

table{
  width:100%;
  border-collapse:collapse;
  background:#fff
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center
}
th{background:#eef5ff}
</style>
</head>

<body>

<h2>ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ´ØºÙŠÙ„ â€” FutureTank</h2>

<button onclick="exportPDF()">ğŸ“„ ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± PDF</button>

<div class="cards">
  <div class="card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù‚ÙˆØ¯</h3><p id="total">0</p></div>
  <div class="card"><h3>ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°</h3><p id="done">0</p></div>
  <div class="card"><h3>Ù…ØªØ£Ø®Ø±</h3><p id="late">0</p></div>
  <div class="card"><h3>Ø®Ù„Ø§Ù„ 5 Ø£ÙŠØ§Ù…</h3><p id="soon">0</p></div>
  <div class="card"><h3>Ø¥ÙŠØ±Ø§Ø¯ Ù…ØªÙˆÙ‚Ø¹</h3><p id="revenue">0</p></div>
</div>

<table>
<thead>
<tr>
  <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
  <th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
  <th>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø©</th>
  <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
  <th>Ø§Ù„ØªÙƒÙ„ÙØ©</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>
const db = JSON.parse(localStorage.getItem("ft_db")||"{}");
const contracts = db.contracts||[];

const today = new Date();
const in5 = new Date(); in5.setDate(today.getDate()+5);

let done=0, late=0, soon=0, revenue=0;

contracts.forEach(c=>{
  const d = new Date(c.nextVisit);
  revenue += Number(c.cost||0);
  if(c.status==="ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°") done++;
  if(d < today && c.status!=="ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°") late++;
  if(d>=today && d<=in5) soon++;
});

document.getElementById("total").innerText = contracts.length;
document.getElementById("done").innerText = done;
document.getElementById("late").innerText = late;
document.getElementById("soon").innerText = soon;
document.getElementById("revenue").innerText = revenue+" Ø¬Ù†ÙŠÙ‡";

const body = document.getElementById("tableBody");
contracts.forEach(c=>{
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${c.client}</td>
    <td>${c.service}</td>
    <td>${c.nextVisit}</td>
    <td>${c.status}</td>
    <td>${c.cost} Ø¬Ù†ÙŠÙ‡</td>
  `;
  body.appendChild(tr);
});

function exportPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.text("FutureTank - ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ´ØºÙŠÙ„", 105, 15, {align:"center"});
  doc.text("Ø§Ù„ØªØ§Ø±ÙŠØ®: "+new Date().toLocaleDateString("ar-EG"), 105, 25, {align:"center"});

  doc.autoTable({
    startY:35,
    head:[["Ø§Ù„Ø¹Ù…ÙŠÙ„","Ø§Ù„Ø®Ø¯Ù…Ø©","Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø©","Ø§Ù„Ø­Ø§Ù„Ø©","Ø§Ù„ØªÙƒÙ„ÙØ©"]],
    body: contracts.map(c=>[
      c.client,
      c.service,
      c.nextVisit,
      c.status,
      c.cost+" Ø¬Ù†ÙŠÙ‡"
    ]),
    styles:{font:"helvetica",fontSize:10}
  });

  doc.save("FutureTank_Report.pdf");
}
</script>

</body>
</html>
