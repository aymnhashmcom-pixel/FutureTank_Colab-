<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ´ØºÙŠÙ„ â€” FutureTank</title>
<style>
body{font-family:Tahoma;background:#f4f9ff;margin:20px}
h2{color:#4a90e2}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px}
.card{
  background:#fff;
  padding:15px;
  border-radius:12px;
  box-shadow:0 6px 20px rgba(0,0,0,.08);
  text-align:center
}
.card h3{margin:5px 0;color:#666}
.card strong{font-size:28px;color:#4a90e2}
table{
  width:100%;
  margin-top:25px;
  border-collapse:collapse;
  background:#fff
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center
}
th{background:#eef5ff}
.bad{color:#c0392b;font-weight:bold}
.good{color:#27ae60;font-weight:bold}
</style>
</head>

<body>

<h2>ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ´ØºÙŠÙ„ â€” FutureTank</h2>

<div class="cards">
  <div class="card">
    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù‚ÙˆØ¯</h3>
    <strong id="totalContracts">0</strong>
  </div>
  <div class="card">
    <h3>Ø²ÙŠØ§Ø±Ø§Øª Ù‚Ø§Ø¯Ù…Ø© (7 Ø£ÙŠØ§Ù…)</h3>
    <strong id="upcoming">0</strong>
  </div>
  <div class="card">
    <h3>Ø²ÙŠØ§Ø±Ø§Øª Ù…ØªØ£Ø®Ø±Ø©</h3>
    <strong id="late">0</strong>
  </div>
  <div class="card">
    <h3>Ø²ÙŠØ§Ø±Ø§Øª Ù…Ù†ÙØ°Ø©</h3>
    <strong id="done">0</strong>
  </div>
  <div class="card">
    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</h3>
    <strong id="revenue">0</strong> Ø¬Ù†ÙŠÙ‡
  </div>
</div>

<h3>ğŸ“… Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø©</h3>

<table>
<thead>
<tr>
  <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
  <th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
  <th>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø©</th>
  <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>
const db = JSON.parse(localStorage.getItem("ft_db") || "{}");
const contracts = db.contracts || [];

const today = new Date();
const in7 = new Date();
in7.setDate(today.getDate()+7);

let upcoming=0, late=0, done=0, revenue=0;

contracts.forEach(c=>{
  const next = new Date(c.nextVisit);
  revenue += Number(c.cost || 0);

  if(c.status==="ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°") done++;
  if(next < today && c.status!=="ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°") late++;
  if(next>=today && next<=in7) upcoming++;
});

document.getElementById("totalContracts").innerText = contracts.length;
document.getElementById("upcoming").innerText = upcoming;
document.getElementById("late").innerText = late;
document.getElementById("done").innerText = done;
document.getElementById("revenue").innerText = revenue;

const body = document.getElementById("tableBody");
contracts
  .filter(c=>{
    const d = new Date(c.nextVisit);
    return d>=today && d<=in7;
  })
  .forEach(c=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
<td>${c.client}</td>
<td>${c.service}</td>
<td>${c.nextVisit}</td>
<td class="${c.status==='ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°'?'good':'bad'}">${c.status}</td>
    `;
    body.appendChild(tr);
  });
</script>

</body>
  </html>
