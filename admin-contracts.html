<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯</title>
<link rel="stylesheet" href="styles.css">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>

<h2>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯</h2>

<div class="card">
  <h3>â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø¯</h3>

  <label>ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
  <select id="contractClient"></select>

  <label>ğŸ§° Ø§Ù„Ø®Ø¯Ù…Ø©</label>
  <select id="contractService"></select>

  <input type="number" id="contractPrice" placeholder="ØªÙƒÙ„ÙØ© Ø§Ù„Ø¹Ù‚Ø¯ Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡">

  <label>ğŸ“ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</label>
  <input type="date" id="nextVisit">

  <button onclick="addContract()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø¯</button>
  <p id="status"></p>
</div>

<hr>

<h3>ğŸ“‹ Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
<div id="contracts"></div>

<script>
// Firebase init
firebase.initializeApp({
  apiKey: "AIzaSyBmWKWIPtVjUYXGOF77Zstmz3ROpvKIDog",
  authDomain: "futuretank-68c26.firebaseapp.com",
  projectId: "futuretank-68c26"
});

const db = firebase.firestore();

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
db.collection("clients").onSnapshot(snap => {
  const select = document.getElementById("contractClient");
  select.innerHTML = "<option value=''>-- Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„ --</option>";
  snap.forEach(doc => {
    const c = doc.data();
    select.innerHTML += `<option value="${doc.id}|${c.name}">${c.name}</option>`;
  });
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
db.collection("services").onSnapshot(snap => {
  const select = document.getElementById("contractService");
  select.innerHTML = "<option value=''>-- Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø© --</option>";
  snap.forEach(doc => {
    const s = doc.data();
    select.innerHTML += `<option value="${doc.id}|${s.name}">${s.name}</option>`;
  });
});

// Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø¯
function addContract() {
  const clientVal = document.getElementById("contractClient").value;
  const serviceVal = document.getElementById("contractService").value;
  const price = Number(document.getElementById("contractPrice").value || 0);
  const nextVisit = document.getElementById("nextVisit").value;
  const status = document.getElementById("status");

  if (!clientVal || !serviceVal) {
    status.innerText = "âŒ Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ø®Ø¯Ù…Ø©";
    return;
  }

  const [clientId, clientName] = clientVal.split("|");
  const [serviceId, serviceName] = serviceVal.split("|");

  status.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";

  db.collection("contracts").add({
    clientId,
    clientName,
    serviceId,
    serviceName,
    price,
    nextVisit,
    createdAt: new Date()
  }).then(() => {
    status.innerText = "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø¯";
    document.querySelectorAll(".card input, .card select").forEach(e => e.value = "");
  }).catch(() => {
    status.innerText = "âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©";
  });
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù‚ÙˆØ¯
db.collection("contracts").orderBy("createdAt","desc")
.onSnapshot(snap => {
  const box = document.getElementById("contracts");
  box.innerHTML = "";

  snap.forEach(doc => {
    const c = doc.data();
    box.innerHTML += `
      <div class="item">
        <b>${c.clientName}</b><br>
        ğŸ§° ${c.serviceName}<br>
        ğŸ’° ${c.price} Ø¬Ù†ÙŠÙ‡<br>
        ğŸ“ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${c.nextVisit || "â€”"}<br>
        <button onclick="deleteContract('${doc.id}')">ğŸ—‘ Ø­Ø°Ù</button>
      </div><hr>
    `;
  });
});

// Ø­Ø°Ù Ø¹Ù‚Ø¯
function deleteContract(id) {
  if (!confirm("âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø¯ØŸ")) return;
  db.collection("contracts").doc(id).delete();
}
</script>

</body>
</html>
