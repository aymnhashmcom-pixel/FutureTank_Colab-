<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯</title>
<link rel="stylesheet" href="styles.css">

<style>
body { direction: rtl; font-family: Arial; background:#f6f7f9; }
.card { background:#fff; padding:15px; margin:15px 0; border-radius:8px; }
.item { background:#fafafa; padding:10px; border-radius:6px; margin-bottom:10px; }
button { margin:5px 0; padding:6px 10px; cursor:pointer; }
select { padding:5px; }
</style>

<!-- Firebase -->
<script type="module">
import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  deleteDoc,
  doc,
  updateDoc,
  orderBy,
  query
} from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ğŸ”¥ Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyBmWKWIPtVjUYXGOF77Zstmz3ROpvKIDog",
  authDomain: "futuretank-68c26.firebaseapp.com",
  projectId: "futuretank-68c26"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ==========================
   ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù‚ÙˆØ¯
========================== */
async function loadContracts() {
  const box = document.getElementById("contracts");
  box.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

  const q = query(
    collection(db, "contracts"),
    orderBy("createdAt", "desc")
  );

  const snap = await getDocs(q);
  box.innerHTML = "";

  if (snap.empty) {
    box.innerHTML = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù‚ÙˆØ¯ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†";
    return;
  }

  snap.forEach(d => {
    const c = d.data();

    box.innerHTML += `
      <div class="item">
        <b>ğŸ‘¤ ${c.clientName}</b><br>
        ğŸ“ ${c.phone}<br>
        ğŸ§° ${c.service || "â€”"}<br>
        ğŸ’° ${c.cost || 0} Ø¬Ù†ÙŠÙ‡<br>
        ğŸ“… ${c.startDate || "â€”"} â†’ ${c.endDate || "â€”"}<br>
        ğŸ“ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${c.nextVisit || "â€”"}<br>
        ğŸ”„ Ø§Ù„Ø­Ø§Ù„Ø©:
        <select onchange="updateStatus('${d.id}', this.value)">
          <option ${c.status==="pending"?"selected":""}>pending</option>
          <option ${c.status==="active"?"selected":""}>active</option>
          <option ${c.status==="finished"?"selected":""}>finished</option>
        </select>
        <br>

        <a target="_blank"
           href="https://wa.me/201150402031?text=Ø¹Ù‚Ø¯:${c.clientName}">
           ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨
        </a>

        <button onclick="deleteContract('${d.id}')">ğŸ—‘ Ø­Ø°Ù</button>
      </div>
    `;
  });
}

/* ==========================
   Ø­Ø°Ù Ø¹Ù‚Ø¯
========================== */
window.deleteContract = async function(id) {
  if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø¯ØŸ")) return;
  await deleteDoc(doc(db, "contracts", id));
  loadContracts();
}

/* ==========================
   ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù‚Ø¯
========================== */
window.updateStatus = async function(id, status) {
  await updateDoc(doc(db, "contracts", id), { status });
}

/* ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ */
loadContracts();
</script>

</head>

<body>

<h2>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯</h2>

<div class="card">
  <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
</div>

<div id="contracts"></div>

</body>
  </html>
