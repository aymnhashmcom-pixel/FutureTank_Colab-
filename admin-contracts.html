<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯</title>
<link rel="stylesheet" href="styles.css">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{direction:rtl;font-family:Arial;background:#f5f5f5;padding:20px}
.card{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{padding:10px;border-bottom:1px solid #ddd;text-align:center}
th{background:#eee}
.status{font-weight:bold}
.pending{color:#ff9800}
.active{color:#4caf50}
</style>
</head>

<body>

<h2>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯</h2>

<table>
<thead>
<tr>
<th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
<th>Ø§Ù„Ù‡Ø§ØªÙ</th>
<th>Ø§Ù„Ù…ØµØ¯Ø±</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
<th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
<th>Ø¥Ø¬Ø±Ø§Ø¡</th>
</tr>
</thead>
<tbody id="contracts"></tbody>
</table>

<script>
// Firebase init
firebase.initializeApp({
  apiKey: "AIzaSyBmWKWIPtVjUYXGOF77Zstmz3ROpvKIDog",
  authDomain: "futuretank-68c26.firebaseapp.com",
  projectId: "futuretank-68c26"
});

const db = firebase.firestore();
const box = document.getElementById("contracts");

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù‚ÙˆØ¯
db.collection("contracts")
  .orderBy("createdAt","desc")
  .onSnapshot(snapshot => {
    box.innerHTML = "";
    snapshot.forEach(doc => {
      const c = doc.data();
      const date = c.createdAt?.toDate
        ? c.createdAt.toDate().toLocaleDateString("ar-EG")
        : "â€”";

      box.innerHTML += `
        <tr>
          <td>${c.clientName || "â€”"}</td>
          <td>${c.phone || "â€”"}</td>
          <td>${c.source || "â€”"}</td>
          <td class="status ${c.status}">
            ${c.status === "pending" ? "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©" : "Ù†Ø´Ø·"}
          </td>
          <td>${date}</td>
          <td>
            <button onclick="activateContract('${doc.id}')">âœ”ï¸ ØªÙØ¹ÙŠÙ„</button>
            <button onclick="deleteContract('${doc.id}')">ğŸ—‘ Ø­Ø°Ù</button>
          </td>
        </tr>
      `;
    });
  });

// ØªÙØ¹ÙŠÙ„ Ø¹Ù‚Ø¯
function activateContract(id){
  if(!confirm("ØªØ£ÙƒÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø¯ØŸ")) return;
  db.collection("contracts").doc(id).update({
    status:"active"
  });
}

// Ø­Ø°Ù Ø¹Ù‚Ø¯
function deleteContract(id){
  if(!confirm("âš ï¸ Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø¯ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ")) return;
  db.collection("contracts").doc(id).delete();
}
</script>

</body>
</html>
